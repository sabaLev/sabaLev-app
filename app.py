import streamlit as st
import pandas as pd
import numpy as np
from datetime import date, time, datetime

st.title("üìã –ù–∞—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ Streamlit —Å–æ –≤—Å–µ–º–∏ —Ç–∏–ø–∞–º–∏ –ø–æ–ª–µ–π")

# –°–æ–∑–¥–∞–µ–º DataFrame —Å–æ –≤—Å–µ–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
df = pd.DataFrame({
    'ID': [1, 2, 3, 4],
    '–¢–µ–∫—Å—Ç': ['–ü—Ä–∏–º–µ—Ä —Ç–µ–∫—Å—Ç–∞', '–î—Ä—É–≥–æ–π —Ç–µ–∫—Å—Ç', '–ï—â—ë —Ç–µ–∫—Å—Ç', '–ü–æ—Å–ª–µ–¥–Ω–∏–π'],
    '–ß–∏—Å–ª–æ': [100, 200, 300, 400],
    '–î–µ—Å—è—Ç–∏—á–Ω–æ–µ': [10.5, 20.3, 30.7, 40.9],
    '–î–∞—Ç–∞': [date(2023, 1, 1), date(2023, 2, 1), date(2023, 3, 1), date(2023, 4, 1)],
    '–í—Ä–µ–º—è': [time(9, 0), time(10, 30), time(12, 0), time(15, 45)],
    '–î–∞—Ç–∞–í—Ä–µ–º—è': [
        datetime(2023, 1, 1, 9, 0),
        datetime(2023, 2, 1, 10, 30),
        datetime(2023, 3, 1, 12, 0),
        datetime(2023, 4, 1, 15, 45)
    ],
    '–ß–µ–∫–±–æ–∫—Å': [True, False, True, False],
    '–í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫': ['–í–∞—Ä–∏–∞–Ω—Ç A', '–í–∞—Ä–∏–∞–Ω—Ç B', '–í–∞—Ä–∏–∞–Ω—Ç C', '–í–∞—Ä–∏–∞–Ω—Ç A'],
    '–ü—Ä–æ–≥—Ä–µ—Å—Å': [0.25, 0.5, 0.75, 1.0],
    '–°—Å—ã–ª–∫–∞': [
        'https://streamlit.io',
        'https://pandas.pydata.org',
        'https://python.org',
        'https://numpy.org'
    ],
    '–ì–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∞': [
        'https://streamlit.io',
        'https://pandas.pydata.org',
        'https://python.org',
        'https://numpy.org'
    ],
    '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ URL': [
        'https://streamlit.io/images/brand/streamlit-mark-color.png',
        'https://pandas.pydata.org/static/img/pandas.svg',
        'https://www.python.org/static/community_logos/python-logo.png',
        'https://numpy.org/images/logo.svg'
    ],
    '–ì—Ä–∞—Ñ–∏–∫': [
        np.array([1, 2, 3]),
        np.array([2, 3, 4]),
        np.array([3, 4, 5]),
        np.array([4, 5, 6])
    ],
    '–°–ø–∏—Å–æ–∫': [
        ['—è–±–ª–æ–∫–æ', '–±–∞–Ω–∞–Ω'],
        ['–∞–ø–µ–ª—å—Å–∏–Ω', '–ª–∏–º–æ–Ω'],
        ['–≤–∏–Ω–æ–≥—Ä–∞–¥', '–≥—Ä—É—à–∞'],
        ['–ø–µ—Ä—Å–∏–∫', '—Å–ª–∏–≤–∞']
    ],
    '–°–ª–æ–≤–∞—Ä—å': [
        {'–∫–ª—é—á1': '–∑–Ω–∞—á–µ–Ω–∏–µ1'},
        {'–∫–ª—é—á2': '–∑–Ω–∞—á–µ–Ω–∏–µ2'},
        {'–∫–ª—é—á3': '–∑–Ω–∞—á–µ–Ω–∏–µ3'},
        {'–∫–ª—é—á4': '–∑–Ω–∞—á–µ–Ω–∏–µ4'}
    ]
})

st.write("### –¢–∞–±–ª–∏—Ü–∞ —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π")

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è data_editor
edited_df = st.data_editor(
    df,
    num_rows="dynamic",  # –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫
    use_container_width=True,
    hide_index=True,
    column_config={
        # ID - —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ
        'ID': st.column_config.Column(
            "ID",
            width="small",
            disabled=True  # –ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        ),
        
        # –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
        '–¢–µ–∫—Å—Ç': st.column_config.TextColumn(
            "–¢–µ–∫—Å—Ç",
            width="medium",
            max_chars=50,  # –ú–∞–∫—Å–∏–º—É–º —Å–∏–º–≤–æ–ª–æ–≤
            help="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤"
        ),
        
        # –ß–∏—Å–ª–æ–≤–æ–µ –ø–æ–ª–µ (—Ü–µ–ª–æ–µ)
        '–ß–∏—Å–ª–æ': st.column_config.NumberColumn(
            "–¶–µ–ª–æ–µ —á–∏—Å–ª–æ",
            min_value=0,
            max_value=1000,
            step=1,
            format="%d —à—Ç.",
            help="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 1000"
        ),
        
        # –ß–∏—Å–ª–æ–≤–æ–µ –ø–æ–ª–µ (–¥–µ—Å—è—Ç–∏—á–Ω–æ–µ)
        '–î–µ—Å—è—Ç–∏—á–Ω–æ–µ': st.column_config.NumberColumn(
            "–î–µ—Å—è—Ç–∏—á–Ω–æ–µ —á–∏—Å–ª–æ",
            min_value=0.0,
            max_value=100.0,
            step=0.1,
            format="%.2f",
            help="–í–≤–µ–¥–∏—Ç–µ –¥–µ—Å—è—Ç–∏—á–Ω–æ–µ —á–∏—Å–ª–æ"
        ),
        
        # –î–∞—Ç–∞
        '–î–∞—Ç–∞': st.column_config.DateColumn(
            "–î–∞—Ç–∞",
            min_value=date(2020, 1, 1),
            max_value=date(2025, 12, 31),
            format="DD.MM.YYYY",
            help="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É"
        ),
        
        # –í—Ä–µ–º—è
        '–í—Ä–µ–º—è': st.column_config.TimeColumn(
            "–í—Ä–µ–º—è",
            format="HH:mm",
            help="–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è"
        ),
        
        # –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
        '–î–∞—Ç–∞–í—Ä–µ–º—è': st.column_config.DatetimeColumn(
            "–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è",
            format="DD.MM.YYYY HH:mm",
            help="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è"
        ),
        
        # –ß–µ–∫–±–æ–∫—Å
        '–ß–µ–∫–±–æ–∫—Å': st.column_config.CheckboxColumn(
            "–°—Ç–∞—Ç—É—Å",
            default=False,
            help="–í–∫–ª—é—á–µ–Ω–æ/–≤—ã–∫–ª—é—á–µ–Ω–æ"
        ),
        
        # –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
        '–í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫': st.column_config.SelectboxColumn(
            "–í—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞",
            options=["–í–∞—Ä–∏–∞–Ω—Ç A", "–í–∞—Ä–∏–∞–Ω—Ç B", "–í–∞—Ä–∏–∞–Ω—Ç C", "–í–∞—Ä–∏–∞–Ω—Ç D"],
            help="–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞"
        ),
        
        # –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
        '–ü—Ä–æ–≥—Ä–µ—Å—Å': st.column_config.ProgressColumn(
            "–ü—Ä–æ–≥—Ä–µ—Å—Å",
            min_value=0.0,
            max_value=1.0,
            format="%.0f%%",
            help="–£–∫–∞–∂–∏—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç 0 –¥–æ 100%"
        ),
        
        # –°—Å—ã–ª–∫–∞ (–ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç)
        '–°—Å—ã–ª–∫–∞': st.column_config.TextColumn(
            "URL —Å—Å—ã–ª–∫–∞",
            help="–í–≤–µ–¥–∏—Ç–µ URL"
        ),
        
        # –ì–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∞
        '–ì–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∞': st.column_config.LinkColumn(
            "–ì–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∞",
            help="–ö–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞",
            display_text="–ü–µ—Ä–µ–π—Ç–∏"
        ),
        
        # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ URL
        '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ URL': st.column_config.ImageColumn(
            "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
            help="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
        ),
        
        # –ì—Ä–∞—Ñ–∏–∫ (—Å—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞)
        '–ì—Ä–∞—Ñ–∏–∫': st.column_config.BarChartColumn(
            "–ì—Ä–∞—Ñ–∏–∫",
            y_min=0,
            y_max=10,
            help="–î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞"
        ),
        
        # –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π
        '–°–ø–∏—Å–æ–∫': st.column_config.ListColumn(
            "–°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π",
            help="–°–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫"
        ),
        
        # –°–ª–æ–≤–∞—Ä—å/JSON
        '–°–ª–æ–≤–∞—Ä—å': st.column_config.Column(
            "–°–ª–æ–≤–∞—Ä—å/JSON",
            help="–î–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å–ª–æ–≤–∞—Ä—è"
        )
    }
)

# –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
st.write("### –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:")
st.write(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: {len(edited_df)}")

# –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
col1, col2, col3 = st.columns(3)

with col1:
    if st.button("üìã –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö"):
        st.write("–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:")
        st.write(edited_df.dtypes)

with col2:
    if st.button("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —á–∏—Å–ª–∞–º"):
        numeric_cols = edited_df.select_dtypes(include=[np.number])
        if not numeric_cols.empty:
            st.write("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
            st.write(numeric_cols.describe())

with col3:
    if st.button("üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω—ã–º"):
        # –î–ª—è —Å–±—Ä–æ—Å–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
        st.rerun()

# –ü–æ–∫–∞–∑–∞—Ç—å JSON –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
with st.expander("üîß –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ JSON"):
    st.json(edited_df.to_dict(orient='records'))

# –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
st.write("### üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö")
csv = edited_df.to_csv(index=False).encode('utf-8')

st.download_button(
    label="üíæ –°–∫–∞—á–∞—Ç—å –∫–∞–∫ CSV",
    data=csv,
    file_name="—Ç–∞–±–ª–∏—Ü–∞_–¥–∞–Ω–Ω—ã—Ö.csv",
    mime="text/csv"
)
